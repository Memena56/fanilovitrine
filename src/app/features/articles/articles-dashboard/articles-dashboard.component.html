<section class="max-w-6xl mx-auto px-4 py-8 font-sans">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6 gap-3">
    <h2 class="text-3xl font-extrabold text-[#2A255E] tracking-tight">
      VOKATRA My Fanilo Shop
    </h2>
    <div class="flex gap-2">
      <button (click)="openForm()"
        class="inline-flex items-center gap-2 bg-[#2A255E] text-[#FFD600] font-bold px-4 py-2 rounded-lg shadow hover:bg-[#FFD600] hover:text-[#2A255E] transition duration-150">
        <span class="inline-block text-[#2A255E] bg-[#FFD600] rounded-full w-6 h-6 flex justify-center items-center font-bold mr-1 text-lg">
          +
        </span>
        Hampiditra vokatra
      </button>
      <button (click)="logout()"
        class="inline-flex items-center bg-red-600 text-white font-normal px-4 py-2 rounded-lg shadow hover:bg-red-700 transition duration-150">
        Miala
      </button>
    </div>
  </div>

  <!-- Tableau des articles -->
  <div class="overflow-auto">
    <table class="min-w-full bg-white border-2 border-[#FFD600] rounded-lg shadow font-sans">
      <thead>
        <tr class="bg-[#2A255E] text-[#FFD600] text-sm">
          <th class="px-4 py-2 text-left font-bold">Daty</th>
          <th class="px-4 py-2 text-left font-bold">Lohateny</th>
          <th class="px-4 py-2 text-left font-bold">Sarany</th>
          <th class="px-4 py-2 text-left font-bold">Stock</th>
          <th class="px-4 py-2 text-right font-bold">Fikirakirana</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let article of articles" class="border-t hover:bg-[#FFFDE7] transition duration-150 text-sm">
          <td class="px-4 py-2">{{ article.createdAt | date: 'dd/MM/yyyy' }}</td>
          <td class="px-4 py-2 font-semibold">{{ article.title }}</td>
          <td class="px-4 py-2">{{ article.price }} {{ article.currency }}</td>
          <td class="px-4 py-2">{{ article.stock }}</td>
          <td class="px-4 py-2 text-right flex gap-2 justify-end">
            <button (click)="editArticle(article)" class="text-[#2A255E] hover:text-[#FFD600] font-bold transition" title="Hanova">
              ‚úèÔ∏è
            </button>
            <button (click)="deleteArticle(article._id)" class="text-red-600 hover:text-red-800 font-bold transition" title="Hamafa">
              üóëÔ∏è
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Modal Form -->
<div *ngIf="isFormOpen" class="fixed inset-0 bg-[#2A255E]/20 backdrop-blur-sm flex items-center justify-center z-50 font-sans">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl p-6 relative max-h-[90vh] overflow-y-auto border-2 border-[#FFD600]">
    <button (click)="closeForm()" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-2xl cursor-pointer">
      &times;
    </button>

    <h3 class="text-2xl font-extrabold mb-4 text-[#2A255E]">
      {{ isEditing ? 'Hanova mombamomba ny vokatra' : 'Hampiditra vokatra vaovao' }}
    </h3>

    <form (ngSubmit)="submitArticle()" class="grid gap-6 md:grid-cols-2">
      <!-- Titre -->
      <div>
        <label class="block text-sm font-medium mb-1 text-[#2A255E]">Lohateny</label>
        <input [(ngModel)]="title" name="title" required class="w-full border border-[#FFD600] px-3 py-2 rounded focus:ring-[#FFD600] focus:border-[#FFD600]" />
      </div>

      <!-- Slug -->
      <div>
        <label class="block text-sm font-medium mb-1 text-[#2A255E]">Slug</label>
        <input [(ngModel)]="slug" name="slug" required class="w-full border border-[#FFD600] px-3 py-2 rounded focus:ring-[#FFD600] focus:border-[#FFD600]" />
      </div>

      <!-- Description -->
      <div class="md:col-span-2">
        <label class="block text-sm font-medium mb-1 text-[#2A255E]">Mombamomba</label>
        <textarea [(ngModel)]="description" name="description" rows="3" required
          class="w-full border border-[#FFD600] px-3 py-2 rounded focus:ring-[#FFD600] focus:border-[#FFD600]"></textarea>
      </div>

      <!-- Prix -->
      <div>
        <label class="block text-sm font-medium mb-1 text-[#2A255E]">Sarany</label>
        <input type="number" [(ngModel)]="price" name="price" required
          class="w-full border border-[#FFD600] px-3 py-2 rounded focus:ring-[#FFD600] focus:border-[#FFD600]" />
      </div>

      <!-- Devise -->
      <div>
        <label class="block text-sm font-medium mb-1 text-[#2A255E]">Devise</label>
        <input [(ngModel)]="currency" name="currency"
          class="w-full border border-[#FFD600] px-3 py-2 rounded focus:ring-[#FFD600] focus:border-[#FFD600]" />
      </div>

      <!-- Stock -->
      <div>
        <label class="block text-sm font-medium mb-1 text-[#2A255E]">Stock</label>
        <input type="number" [(ngModel)]="stock" name="stock" required
          class="w-full border border-[#FFD600] px-3 py-2 rounded focus:ring-[#FFD600] focus:border-[#FFD600]" />
      </div>

      <!-- Tailles -->
      <div>
        <label class="block text-sm font-medium mb-1 text-[#2A255E]">Habeny (sarahana faingo)</label>
        <input [(ngModel)]="sizesInput" name="sizes"
          (ngModelChange)="onSizesInputChange($event)"
          class="w-full border border-[#FFD600] px-3 py-2 rounded focus:ring-[#FFD600] focus:border-[#FFD600]" />
      </div>

      <!-- Tags -->
      <div>
        <label class="block text-sm font-medium mb-1 text-[#2A255E]">Tags (sarahana faingo)</label>
        <input [(ngModel)]="tagsInput" name="tags"
          (ngModelChange)="onTagsInputChange($event)"
          class="w-full border border-[#FFD600] px-3 py-2 rounded focus:ring-[#FFD600] focus:border-[#FFD600]" />
      </div>

      <!-- Cat√©gorie -->
      <div class="md:col-span-2">
        <label class="block text-sm font-medium mb-1 text-[#2A255E]">Cat√©gorie</label>
        <select [(ngModel)]="selectedCategoryId" name="category" required
          class="w-full border border-[#FFD600] px-3 py-2 rounded focus:ring-[#FFD600] focus:border-[#FFD600]">
          <option value="" disabled selected hidden>-- Misafidy sokajy --</option>
          <option *ngFor="let option of getCategoryOptions(categories)" [value]="option._id">
            {{ option.name }}
          </option>
        </select>
      </div>

      <!-- Images -->
      <div class="md:col-span-2">
        <label class="block mb-1 font-medium text-[#2A255E]">Sary</label>
        <input #imagesInput type="file" (change)="onImageFilesSelected($event)" multiple accept="image/*" class="hidden" />
        <button type="button" (click)="imagesInput.click()"
          class="bg-[#2A255E] text-[#FFD600] font-bold px-4 py-2 rounded-lg shadow hover:bg-[#FFD600] hover:text-[#2A255E] transition">
          Misafidy sary
        </button>
        <div *ngIf="previewImages.length > 0" class="mt-2 flex flex-wrap gap-2">
          <div *ngFor="let preview of previewImages; let i = index" class="relative group">
            <img [src]="preview" class="w-20 h-20 object-cover rounded shadow" />
            <button type="button" (click)="removeSelectedImage(i)"
              class="absolute -top-2 -right-2 bg-[#FFD600] text-[#2A255E] font-bold rounded-full w-5 h-5 text-xs hidden group-hover:block">
              &times;
            </button>
          </div>
        </div>
        <div *ngIf="editingImages.length > 0 && previewImages.length === 0" class="mt-2">
          <p class="text-sm text-gray-600">Sary :</p>
          <div class="flex flex-wrap gap-2 mt-1">
            <div *ngFor="let img of editingImages; let i = index" class="relative group">
              <img [src]="img" class="w-20 h-20 object-cover rounded shadow" />
              <button type="button" (click)="removeExistingImage(i)"
                class="absolute -top-2 -right-2 bg-[#FFD600] text-[#2A255E] font-bold rounded-full w-5 h-5 text-xs hidden group-hover:block">
                &times;
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Boutons -->
      <div class="md:col-span-2 flex justify-between items-center mt-4">
        <button type="submit"
          class="bg-[#FFD600] text-[#2A255E] font-bold px-6 py-2 rounded-lg shadow hover:bg-[#2A255E] hover:text-white transition">
          {{ isEditing ? 'Hanova' : 'Hampiditra' }}
        </button>
        <button *ngIf="isEditing" type="button" (click)="resetForm()" class="text-sm text-gray-500 hover:text-[#FFD600] hover:underline cursor-pointer">
          Aoka ihany
        </button>
      </div>
    </form>
  </div>
</div>
